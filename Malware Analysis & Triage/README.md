# Malware Analysis & Triage class

### download virtualbox
https://www.virtualbox.org/wiki/Downloads
### download windows iso
https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterprise
### download remnux iso
https://docs.remnux.org/install-distro/get-virtual-appliance

make sure to deactivate windows defender or flare will not install correct(trust me i messed uped for you)
<br/>

make vms in virtualbox of the windows and remnux
<br/>
in windows vm add flare-vm
<br/>
https://github.com/mandiant/flare-vm
<br/>
follow install instructions

### config inetsim 
use: inetsim
<br/>
open config file to edit
<br/>
use: sudo nano /etc/inetsim/inetsim.conf
<br/>
change setting:
<br/>
add.......




### tips
inetsim is tempermental so when starting a new session
1. start inetsim
2. set flare-vm to auto get dns in network settings if not set like that already
3. save
4. go back into network settings
5. set alt dns to ip of inetsim
6. it should work on now  

# safety always
a good pratice is to defang the malware from miss clicks on a computer that the malware will destroy
<br/>
when getting a piece of malware say ransom.exe append a .malz or anything that will make it nonexecutable

### ransom.exe.malz

after that make sure to password protect the file, alot of analyists use "infected" to secure the file

# trusted sourcing malware
theZoo: https://github.com/ytisf/theZoo
<br/>
VXUnderground GitHub repo: https://github.com/vxunderground/MalwareSourceCode
<br/>
Zeltser Resources: https://zeltser.com/malware-sample-sources/


# Basic Static Analysis 
a good way to figure out if a file is malious is to run the hash or virus in the site virustotal
<br/>
https://www.virustotal.com/gui/home/upload
<br/><br/>
to find the hash of a file we can run powershell scripts
<br/><br/>

sha256
<br/>
Get-FileHash ransome.exe.malz -Algorithm SHA256 | Format-List
<br/><br/>
  
md5
<br/>
Get-FileHash ransome.exe.malz -Algorithm md5 | Format-List
<br/>
md5sum.exe ransome.exe.malz
<br/><br/>

search in virus total and see if that hash is either found or deamed bad
<br/>
not all malware is on virus total 
  

  

# windows API (C or C++)
application programming interface
<br/>
The Windows API, informally WinAPI, is Microsoft's core set of application programming interfaces available in the Microsoft Windows operating systems. The name Windows API collectively refers to several different platform implementations that are often referred to by their own names; see the versions sectio
<br/>
tips
1. in the IMPORT_ADDRESS_TABLE it shows us window api calls
2. shellexecuteW
3. urldownloadtofileW

api resources
<br/>
https://docs.microsoft.com/en-us/windows/win32/apiindex/windows-api-list
<br/>
https://malapi.io

# packed malware
Malware writers often use packing or obfuscation to make their files more difficult to detect or analyze. Obfuscated programs are ones whose execution the malware author has attempted to hide. Packed programs are a subset of obfuscated programs in which the malicious program is compressed and cannot be analyzed.
<br./>
tips
<br/>
1. upx is a good packing program
2. packing malware is a type of compression
3. if raw byte size is 0 or close to it the program is maybe packed, virtual memory will be bigger
4. in run time the malware inflates 
5. packed programs can get around anti viruses

# dynamic analyists
Dynamic malware analysis executes suspected malicious code in a safe environment called a sandbox. This closed system enables security professionals to watch the malware in action without the risk of letting it infect their system or escape into the enterprise network
<br/>
also called heuristic or behavioural analysist
<br/>

types of dynamic
<br/>
HOST
1. delete file 
2. instills persistence

NETWORK
1. download a file
2. calls out to a domain

GRAY AREA
1. dns 
2. it can reach out to the internet but also modify dns records in host 
3. if it is pulling from host logs its host 
4. if pulling from network logs most likely network based 




# tools 

peStudio
<br/>
found in: flare folder > utilities > pestudio
<br/>
PeStudio is a tool used for statically analyzing malware and is one of my favourite tools for malware analysis
<br/>
https://www.winitor.com/download2
<br/>
https://www.hacking.reviews/2017/09/pestudio-malware-initial-assessment-tool.html
<br/><br/>

### Strings from binary
  
Floss
<br/>
use: floss ransome.exe.malz
<br/>
is a tool that pulls string out of a binary file, it will pull out string that are greater than the length of 4.
<br/>
at the bottom of the output floss pulls out special string the program deams odd
<br/><br/>
  
  
peview
<br/>
path: flare folder > utilities folder > peview
<br/>
pplication to browse through the information stored in Portable Executable (PE) file headers and the different sections of the file. In the following tutorials we will be learning how to read those headers when we're examining real malware.
<br/><br/>
places to look in peview
<br/>
1. if the header of the hex starts with MZ or 4D 5A 90 00 30, you are dealing with a portable executable or pe file
2. IMAGE_NT_HEADERS : timestamp, the delphi compliler that some malware is written the timestamp will always say 1992
3. IMAGE_SELECTION_HEADER.TXT : look at the vertuial size and raw byte size and compare using a hex calculator. the virtual size is how much space or memory it is using when ran. If the virtual size is bigger than the raw bytes this program may be known as a packed binary. If both sizes are equal or close it is better to analyze.
4. SECTION_DATA > IMPORT_ADDRESS_DATA : a import place to look a part of the windows api. This is where the windows method calls are located, good to see what system calls the program is exe cuting

  
  
  
  
  
  
  

